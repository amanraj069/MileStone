<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Freelancer Profile</title>
    <link rel="stylesheet" href="/css/FreelancerD/static_elements/sidebar.css" />
    <link rel="stylesheet" href="/css/FreelancerD/profile.css" />
    <link rel="stylesheet" href="/css/FreelancerD/edit-profile.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  </head>
  <body>
    <div class="dashboard-wrapper">
      <!-- Sidebar -->
      <%- include('../partials/sidebar', {activePage: 'profile', user: user}) %>
      <div class="main-content">
        <div class="container">
          <div class="header">
            <h1>Edit Freelancer Profile</h1>
            <a href="/freelancerD/profile" class="back-button">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Back to Profile
            </a>
          </div>

          <div class="edit-form-container">
            <form id="profileEditForm" action="/freelancerD/profile/update" method="POST" enctype="multipart/form-data">
              <div class="form-section">
                <h3 class="form-section-title">Basic Information</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="name">Name</label>
                    <input
                      type="text"
                      id="name"
                      name="name"
                      value="<%= user.name || '' %>"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="title">Title</label>
                    <input
                      type="text"
                      id="title"
                      name="title"
                      value="<%= user.role || '' %>"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="location">Location</label>
                    <input
                      type="text"
                      id="location"
                      name="location"
                      value="<%= user.location || '' %>"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="profileImage">Profile Image</label>
                    <input
                      type="file"
                      id="profileImage"
                      name="profileImage"
                      accept="image/*"
                      onchange="previewImage(this)"
                    />
                    <small class="field-note"
                      >Upload your profile image (JPG, PNG, GIF, WebP - Max 5MB)</small
                    >
                    <!-- Image Preview -->
                    <div id="imagePreview" class="image-preview">
                      <% if (user.picture && user.picture !== '') { %>
                        <img src="<%= user.picture %>" alt="Current Profile Image" id="previewImg">
                        <p class="preview-label">Current Profile Image</p>
                      <% } else { %>
                        <div class="preview-placeholder" id="previewPlaceholder">
                          <i class="fas fa-user-circle"></i>
                          <p>No image selected</p>
                        </div>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="form-section-title">Contact Information</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="email">Email</label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      value="<%= user.email || '' %>"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="phone">Phone</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      value="<%= user.phone || '' %>"
                      pattern="[0-9\s\-\+\(\)]{10,15}"
                      maxlength="15"
                      placeholder="Enter your phone number"
                      title="Please enter a valid phone number (10-15 digits)"
                    />
                    <small class="field-note">Enter a valid phone number (10-15 digits)</small>
                    <div id="phoneError" class="error-message hidden"></div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="form-section-title">About Me</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="about">About</label>
                    <textarea id="about" name="about" rows="6"><%= user.aboutMe || '' %></textarea>
                    <small class="field-note"
                      >Separate paragraphs with a blank line</small
                    >
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="form-section-title">Experience</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label>Experience</label>
                    <div id="experienceContainer" class="experience-container">
                      <% (user.experience || []).forEach((exp, index) => { %>
                        <div class="experience-item" data-index="<%= index %>">
                          <input
                            type="text"
                            class="experience-title"
                            name="experience[<%= index %>][title]"
                            value="<%= exp.title || '' %>"
                            placeholder="Title"
                          />
                          <input
                            type="text"
                            class="experience-date"
                            name="experience[<%= index %>][date]"
                            value="<%= exp.date || '' %>"
                            placeholder="Date"
                          />
                          <textarea
                            class="experience-description"
                            name="experience[<%= index %>][description]"
                            rows="3"
                            placeholder="Description"
                          ><%= exp.description || '' %></textarea>
                          <button
                            type="button"
                            class="remove-btn"
                            onclick="removeItem(this, 'experience')"
                          >Remove</button>
                        </div>
                      <% }) %>
                      <button
                        type="button"
                        id="addExperienceBtn"
                        class="add-btn"
                      >
                        Add Experience
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="form-section-title">Education</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label>Education</label>
                    <div id="educationContainer" class="education-container">
                      <% (user.education || []).forEach((edu, index) => { %>
                        <div class="education-item" data-index="<%= index %>">
                          <input
                            type="text"
                            class="education-title"
                            name="education[<%= index %>][degree]"
                            value="<%= edu.degree || '' %>"
                            placeholder="Degree"
                          />
                          <input
                            type="text"
                            class="education-institution"
                            name="education[<%= index %>][institution]"
                            value="<%= edu.institution || '' %>"
                            placeholder="Institution"
                          />
                          <input
                            type="text"
                            class="education-date"
                            name="education[<%= index %>][date]"
                            value="<%= edu.date || '' %>"
                            placeholder="Date"
                          />
                          <button
                            type="button"
                            class="remove-btn"
                            onclick="removeItem(this, 'education')"
                          >Remove</button>
                        </div>
                      <% }) %>
                      <button
                        type="button"
                        id="addEducationBtn"
                        class="add-btn"
                      >
                        Add Education
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="form-section-title">Portfolio</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label>Portfolio</label>
                    <div id="portfolioContainer" class="portfolio-container">
                      <% (user.portfolio || []).forEach((port, index) => { %>
                        <div class="portfolio-item" data-index="<%= index %>">
                          <label for="portfolioImage<%= index %>">Portfolio Image</label>
                          <input
                            type="file"
                            id="portfolioImage<%= index %>"
                            class="portfolio-image-file"
                            name="portfolioImages"
                            accept="image/*"
                            onchange="previewPortfolioImage(this, '<%= index %>')"
                          />
                          <small class="field-note">Upload portfolio image (JPG, PNG, GIF, WebP - Max 5MB)</small>
                          <div id="portfolioPreview<%= index %>" class="portfolio-preview">
                            <% if (port.image && port.image !== '') { %>
                              <img src="<%= port.image %>" alt="Portfolio Image" id="portfolioPreviewImg<%= index %>">
                              <p class="preview-label">Current Portfolio Image</p>
                            <% } else { %>
                              <div class="preview-placeholder" id="portfolioPreviewPlaceholder<%= index %>">
                                <i class="fas fa-image"></i>
                                <p>No image selected</p>
                              </div>
                            <% } %>
                          </div>
                          <input
                            type="text"
                            class="portfolio-title"
                            name="portfolio[<%= index %>][title]"
                            value="<%= port.title || '' %>"
                            placeholder="Title"
                          />
                          <textarea
                            class="portfolio-description"
                            name="portfolio[<%= index %>][description]"
                            rows="3"
                            placeholder="Description"
                          ><%= port.description || '' %></textarea>
                          <input
                            type="url"
                            class="portfolio-link"
                            name="portfolio[<%= index %>][link]"
                            value="<%= port.link || '' %>"
                            placeholder="Project Link (Optional)"
                          />
                          <button
                            type="button"
                            class="remove-btn"
                            onclick="removeItem(this, 'portfolio')"
                          >Remove</button>
                        </div>
                      <% }) %>
                      <button
                        type="button"
                        id="addPortfolioBtn"
                        class="add-btn"
                      >
                        Add Portfolio Item
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h3 class="form-section-title">Resume</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="resumeLink">Resume Link</label>
                    <input
                      type="url"
                      id="resumeLink"
                      name="resumeLink"
                      value="<%= user.resume || '' %>"
                      placeholder="Enter resume link"
                    />
                    <small class="field-note"
                      >Enter a direct link to your resume (e.g.,
                      https://example.com/resume.pdf)</small
                    >
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <a href="/freelancerD/profile" class="cancel-button">Cancel</a>
                <button type="submit" class="save-button">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="/js/FreelancerD/edit-profile.js"></script>
  </body>
</html>